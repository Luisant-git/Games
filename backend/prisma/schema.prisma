generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id        Int      @id @default(autoincrement())
  name      String?
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum BetType {
  SINGLE
  DOUBLE
  TRIPLE_DIGIT
  FOUR_DIGIT
}

model Game {
  id                    Int           @id @default(autoincrement())
  betType               BetType?
  board                 String?       
  winningAmount         Int?         
  ticket                Int?         
  singleDigitMatching   Int?         
  doubleDigitMatching   Int?          
  tripleDigitMatching   Int?          
  isActive              Boolean       @default(true)
  agentCommissions      AgentCommission[]
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
}

model Player {
  id          Int           @id @default(autoincrement())
  name        String?
  username    String        @unique
  phone       String?       @unique
  password    String
  referalCode String?
  referCode   String        @unique
  referredBy  String?
  agent       Agent?        @relation(fields: [agentId], references: [id])
  agentId     Int?
  wallet      PlayerWallet?
  gameHistory GameHistory[]
  deposits    Deposit[]
  withdraws   Withdraw[]
  supportTickets Support[]
  referralBonuses ReferralBonus[] @relation("ReferrerBonuses")
  bankAccounts BankAccount[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model Agent {
  id        Int           @id @default(autoincrement())
  name      String?
  username  String        @unique
  phone     String?       @unique
  password  String
  plainPassword String?
  referCode String        @unique
  isActive  Boolean       @default(false)
  canPlay   Boolean       @default(true)
  players   Player[]
  wallet    AgentWallet?
  commissions AgentCommission[]
  gameHistory GameHistory[]
  deposits  Deposit[]
  withdraws Withdraw[]
  supportTickets Support[]
  bankAccounts BankAccount[]
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model PlayerWallet {
  id       Int     @id @default(autoincrement())
  balance  Float   @default(0)
  bonusBalance Float @default(0)
  player   Player  @relation(fields: [playerId], references: [id])
  playerId Int     @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AgentWallet {
  id       Int     @id @default(autoincrement())
  balance  Float   @default(0)
  agent    Agent   @relation(fields: [agentId], references: [id])
  agentId  Int     @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model GameHistory {
  id              Int      @id @default(autoincrement())
  player          Player?  @relation(fields: [playerId], references: [id])
  playerId        Int?
  agent           Agent?   @relation(fields: [agentId], references: [id])
  agentId         Int?
  categoryId      Int
  showtimeId      Int
  showTime        DateTime
  playStart       DateTime
  playEnd         DateTime
  totalBetAmount  Float
  totalWinAmount  Float    @default(0)
  agentCommission Float    @default(0)
  isWon           Boolean  @default(false)
  gameplay        GamePlay[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model GamePlay {
  id            Int         @id @default(autoincrement())
  gameHistory   GameHistory @relation(fields: [gameHistoryId], references: [id])
  gameHistoryId Int
  gameId        Int
  board         String
  betType       BetType
  numbers       String      
  qty           Int
  amount        Float
  winAmount     Float?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Category {
   id           Int       @id    @default(autoincrement())
   name         String
   image        String
   createdAt    DateTime   @default(now())
   updatedAt    DateTime   @updatedAt
   timing       Timing[]
}

model Timing {
  id             Int        @id @default(autoincrement())
  categoryId     Int
  category       Category   @relation(fields: [categoryId], references: [id])
  showTimes      ShowTime[]
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

model ShowTime {
  id        Int      @id @default(autoincrement())
  playStart String
  playEnd   String
  showTime  String
  timingId  Int
  timing    Timing   @relation(fields: [timingId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AgentCommission {
  id            Int     @id @default(autoincrement())
  agentId       Int
  gameId        Int
  commissionRate Float
  commissionType CommissionType @default(PLAYER_REFERRAL)
  amount        Float   @default(0)
  fromPlayerId  Int?
  fromAgentId   Int?
  agent         Agent   @relation(fields: [agentId], references: [id])
  game          Game    @relation(fields: [gameId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([agentId, gameId])
}

enum CommissionType {
  PLAYER_REFERRAL
  GAMEPLAY_BONUS
}

model Deposit {
  id              Int           @id @default(autoincrement())
  playerId        Int?
  agentId         Int?
  name            String?
  phone           String
  transferType    TransferType?
  transferDetails Json?
  amount          Float
  ticket          Int?
  screenshot      String
  transactionSlip String?
  status          DepositStatus
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  player          Player?       @relation(fields: [playerId], references: [id])
  agent           Agent?        @relation(fields: [agentId], references: [id])
}

model Withdraw {
  id              Int            @id @default(autoincrement())
  playerId        Int?
  agentId         Int?
  name            String?
  phone           String
  transferType    TransferType?
  transferDetails Json?
  amount          Float
  ticket          Int?
  referenceNumber String?        @unique
  status          WithdrawStatus
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  player          Player?        @relation(fields: [playerId], references: [id])
  agent           Agent?         @relation(fields: [agentId], references: [id])
}

enum TransferType {
  BANK_TRANSFER
  UPI_TRANSFER
}

enum UpiAppName {
  GOOGLE_PAY
  PHONE_PE
}

enum DepositStatus {
  PENDING
  COMPLETED
  FAILED
  MISMATCH
}

enum WithdrawStatus {
  PENDING
  COMPLETED
  FAILED
  MISMATCH
}

model Support {
  id        Int      @id @default(autoincrement())
  playerId  Int?
  agentId   Int?
  subject   String
  message   String
  image     String?
  status    SupportStatus @default(OPEN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  player    Player?  @relation(fields: [playerId], references: [id])
  agent     Agent?   @relation(fields: [agentId], references: [id])
}

enum SupportStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

model ReferralBonus {
  id          Int      @id @default(autoincrement())
  referrerId  Int
  referredId  Int
  amount      Float    @default(100)
  referrer    Player   @relation("ReferrerBonuses", fields: [referrerId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Result {
  id          Int      @id @default(autoincrement())
  date        DateTime
  time        String
  numbers     String
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model DashBoard {
  id                   Int       @id @default(autoincrement())
  totalBetAmount       Int    
  totalAgentCommission Int
  totalProfit          Int
}

model BankAccount {
  id                Int      @id @default(autoincrement())
  playerId          Int?
  agentId           Int?
  accountNumber     String
  ifscCode          String
  bankName          String
  accountHolderName String
  isDefault         Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  player            Player?  @relation(fields: [playerId], references: [id])
  agent             Agent?   @relation(fields: [agentId], references: [id])
}

model Settings {
  id                    Int      @id @default(autoincrement())
  depositStartTime      String   
  depositEndTime        String   
  withdrawStartTime     String   
  withdrawEndTime       String   
  minimumDepositAmount  Float
  minimumWithdrawAmount Float
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}